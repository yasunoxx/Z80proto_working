Proto2 MiniLoader 大まかなフロー

メインフロー
・タイトル"LoAdEr"表示
↓
・SPI ROMチェック
↓
・SPI ROMテーブル0に記載あり　ならばSPIロードへ
↓
・ROM 0100hチェック
↓
・ROM 0100hに31hあり　ならばROMロードへ
↓
・(今のところは)"no Pr9"表示

SPIロード
・テーブル0(0h～0FFh)読み込み
↓
・アドレス0hがデータ0h　でなければメインフローへ戻る
↓
・データ1h～4hをROMアドレス
　データ5h～6hをRAM書き込み先アドレス
　データ7h～8hをサイズ
　データ9h～Ahをジャンプ先アドレス　とする
↓
・ROMアドレスからRAM書き込み先アドレスへサイズ分転送する
↓
・ジャンプ先アドレスへジャンプする

ROMロード
・0100h～07FFhを0E000hへコピー
↓
・0E000hへジャンプ

SPIシーケンス
・CS*を’H'にする(ネゲート, 初期状態)
・SCLKを'L'にする(初期状態)

・リード動作：
・CS*をアサートする('L'にする)
↓
①SCLKを'H'にする
↓
・MISOを読み取る
↓
・SCLKを'L'にする
↓
・MISOから読んだ値をリードレジスタbit0にセット
・リードレジスタを左シフト
↓
・bit長の分だけ①を繰り返す
↓
・CS*をネゲートする

・ライト動作：
・CS*をアサートする('L'にする)
↓
①SCLKを'H'にする
↓
・ライトレジスタbit7をMOSIにセット
・リードレジスタを左シフト
↓
・SCLKを'L'にする
↓
NOP実行
↓
・bit長の分だけ①を繰り返す
↓
・CS*をネゲートする
